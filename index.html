<!DOCTYPE html>
<!-- Version 2.2.0: Grouped Resources & Coherent Structure -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Baker Bettie's Master Recipe Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8fafc; }
        .module-btn.active { background-color: #fff7ed; color: #c2410c; border-right: 4px solid #fb923c; }
        .checkbox-checked { background-color: #f0fdf4; border-color: #bbf7d0; }
        .strikethrough { text-decoration: line-through; color: #9ca3af; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* iOS Safe Area Support */
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="h-[100dvh] w-full flex flex-col md:flex-row overflow-hidden text-slate-800 overscroll-none">

    <!-- MOBILE HEADER -->
    <div class="md:hidden bg-white p-4 border-b border-gray-200 flex justify-between items-center z-20 flex-shrink-0">
        <span class="font-bold text-lg text-orange-600">Baker Bettie Tracker</span>
        <button id="menu-toggle" class="text-slate-600 focus:outline-none p-1">
            <i data-lucide="menu"></i>
        </button>
    </div>

    <!-- SIDEBAR -->
    <div id="sidebar" class="fixed inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 w-72 bg-white border-r border-gray-200 flex flex-col h-full z-30 shadow-lg transition-transform duration-200 ease-in-out">
        <div class="p-6 border-b border-gray-100 bg-orange-50 flex-shrink-0">
            <div class="flex justify-between items-start">
                <h1 class="font-bold text-xl text-slate-800 tracking-tight flex items-center gap-2">
                    <i data-lucide="chef-hat" class="text-orange-500"></i>
                    Baking Track
                </h1>
                <!-- Mobile Close Button -->
                <button id="menu-close" class="md:hidden text-slate-400 hover:text-slate-600">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <p class="text-xs text-slate-500 mt-1">v2.2 â€¢ Fundamentals & Master Recipes</p>
            
            <div class="mt-6">
                <div class="flex justify-between text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">
                    <span>Progress</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-orange-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </div>
        
        <div class="flex-1 overflow-y-auto" id="sidebar-nav">
            <!-- Nav Items Injected via JS -->
        </div>
        
        <!-- SYNC SECTION -->
        <div class="p-4 border-t border-gray-100 bg-slate-50 flex-shrink-0 safe-pb">
            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Sync Devices</p>
            <div class="flex gap-2">
                <button onclick="exportData()" class="flex-1 flex flex-col items-center justify-center p-2 bg-white border border-slate-200 rounded text-xs text-slate-600 hover:text-orange-600 hover:border-orange-300 transition-colors">
                    <i data-lucide="upload-cloud" class="w-4 h-4 mb-1"></i>
                    Backup
                </button>
                <button onclick="importData()" class="flex-1 flex flex-col items-center justify-center p-2 bg-white border border-slate-200 rounded text-xs text-slate-600 hover:text-orange-600 hover:border-orange-300 transition-colors">
                    <i data-lucide="download-cloud" class="w-4 h-4 mb-1"></i>
                    Restore
                </button>
            </div>
        </div>
    </div>

    <!-- OVERLAY FOR MOBILE -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden glass-overlay"></div>

    <!-- MAIN CONTENT -->
    <div class="flex-1 overflow-y-auto bg-slate-50 p-4 md:p-10 safe-pb" id="main-content">
        <!-- Content Injected via JS -->
    </div>

    <script>
        // --- DATA STRUCTURE (v2.2 - Grouped Resources) ---
        // Each step now contains an array of resources (Read, Watch, etc.) for better coherence.
        const modules = {
            prep: {
                title: "1. Getting Started",
                icon: "clipboard-list",
                desc: "The essential 'Pre-Game' skills. Set yourself up for success.",
                steps: [
                    { 
                        id: 'p1', 
                        title: 'Mise en Place', 
                        note: 'The most important lesson: prep your workspace first.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/mise-en-place-for-baking/' },
                            { type: 'video', label: 'Watch Video', url: 'https://www.youtube.com/watch?v=62MOCMyPce0' }
                        ]
                    },
                    { 
                        id: 'p2', 
                        title: 'Essential Equipment', 
                        note: 'Why you need a kitchen scale and bench scraper.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/essential-baking-equipment/' },
                            { type: 'video', label: 'Watch Video', url: 'https://www.youtube.com/watch?v=J3CkrJ9vPJQ' }
                        ]
                    },
                    { 
                        id: 'p3', 
                        title: 'Baking Terminology', 
                        note: 'Definitions of fold, cream, cut in, and proof.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/common-baking-terminology-definitions/' },
                            { type: 'video', label: 'Watch Video', url: 'https://www.youtube.com/watch?v=TB1uVhXKNmQ' }
                        ]
                    },
                    { 
                        id: 'p4', 
                        title: 'Reading a Recipe', 
                        note: 'How to identify timing and temperature needs.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/how-to-read-and-understand-a-recipe/' },
                            { type: 'video', label: 'Watch Video', url: 'https://www.youtube.com/watch?v=e4H7h4Bz9-Q' }
                        ]
                    },
                    { 
                        id: 'p5', 
                        title: 'Measuring Ingredients', 
                        note: 'The "Spoon and Level" method vs. Weighing.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/how-to-measure-flour/' },
                            { type: 'video', label: 'Watch Video', url: 'https://www.youtube.com/watch?v=LouNnXUmANs' }
                        ]
                    }
                ]
            },
            science: {
                title: "2. Ingredient Science",
                icon: "flask-conical",
                desc: "Understanding your building blocks.",
                steps: [
                    { 
                        id: 's1', 
                        title: 'Function of Flour', 
                        note: 'Protein content: Cake flour vs Bread flour.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/varieties-flour/' },
                            { type: 'video', label: 'Watch Video', url: 'https://www.youtube.com/watch?v=g2DbJ-lKcE8' }
                        ]
                    },
                    { 
                        id: 's2', 
                        title: 'All About Gluten', 
                        note: 'When to develop it (bread) vs minimize it (cake).',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/all-about-gluten/' },
                            { type: 'video', label: 'Watch Video', url: 'https://www.youtube.com/watch?v=PCRytLrxs9c' }
                        ]
                    },
                    { 
                        id: 's3', 
                        title: 'Function of Sugar', 
                        note: 'Sugar creates moisture and tenderness.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/function-of-sugar-in-baking/' },
                            { type: 'video', label: 'Watch Video', url: 'https://www.youtube.com/watch?v=N4UOxLGnFfY' },
                            { type: 'recipe', label: 'Lab: Angel Food', url: 'https://bakerbettie.com/how-to-make-angel-food-cake/' }
                        ]
                    },
                    { 
                        id: 's4', 
                        title: 'Function of Eggs', 
                        note: 'Structure, emulsification, and richness.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/function-of-eggs-in-baking/' },
                            { type: 'video', label: 'Watch Video', url: 'https://www.youtube.com/watch?v=jKFILK2ktTk' },
                            { type: 'recipe', label: 'Lab: Chiffon Cake', url: 'https://bakerbettie.com/classic-chiffon-cake/' }
                        ]
                    },
                    { 
                        id: 's5', 
                        title: 'Function of Fat', 
                        note: 'Butter vs Oil vs Shortening.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/function-of-fat-in-baking/' },
                            { type: 'video', label: 'Watch Video', url: 'https://www.youtube.com/watch?v=QjmgQL0k5Dk' },
                            { type: 'recipe', label: 'Lab: Pie Crust', url: 'https://bakerbettie.com/how-to-make-pie-crust/' }
                        ]
                    },
                    { 
                        id: 's6', 
                        title: 'Leavening Agents', 
                        note: 'Baking Soda vs Baking Powder vs Yeast.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/what-is-leavening/' },
                            { type: 'video', label: 'Watch Video', url: 'https://www.youtube.com/watch?v=OoCqGDn1Daw' },
                            { type: 'recipe', label: 'Lab: Choux Pastry', url: 'https://bakerbettie.com/how-to-make-choux-pastry/' }
                        ]
                    },
                    {
                        id: 's7',
                        title: 'Ingredient Temperatures',
                        note: 'Why room temperature eggs matter.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/baking-ingredient-temperatures/' },
                            { type: 'video', label: 'Watch Video', url: 'https://www.youtube.com/watch?v=CEVDoHlQOMc' }
                        ]
                    }
                ]
            },
            muffins: {
                title: "3. The Muffin Method",
                icon: "coffee",
                desc: "The 'Two Bowl' method. Liquid into Dry.",
                steps: [
                    { 
                        id: 'm1', 
                        title: 'Muffin Method Technique', 
                        note: 'Notice how lumpy she leaves the batter.',
                        resources: [
                            { type: 'video', label: 'Watch Technique', url: 'https://www.youtube.com/watch?v=S33wPrQYAXo' },
                            { type: 'recipe', label: 'Master Recipe', url: 'https://bakerbettie.com/master-muffin-recipe/' },
                            { type: 'read', label: 'Variations', url: 'https://bakerbettie.com/5-easy-muffin-variations/' }
                        ]
                    }
                ]
            },
            biscuits: {
                title: "4. The Biscuit Method",
                icon: "layers",
                desc: "Cutting in Fat. Cold butter equals flaky layers.",
                steps: [
                    { 
                        id: 'b1', 
                        title: 'Biscuit Method Technique', 
                        note: 'Visual guide to "pea-sized crumbs".',
                        resources: [
                            { type: 'video', label: 'Watch Technique', url: 'https://bakerbettie.com/how-to-make-biscuits/' },
                            { type: 'recipe', label: 'Master Recipe', url: 'https://bakerbettie.com/best-buttermilk-biscuits/' },
                            { type: 'recipe', label: 'Lab: Pie Crust', url: 'https://bakerbettie.com/how-to-make-pie-crust/' }
                        ]
                    }
                ]
            },
            creaming: {
                title: "5. The Creaming Method",
                icon: "cookie",
                desc: "Butter + Sugar + Air. Cookies and Cakes.",
                steps: [
                    { 
                        id: 'c1', 
                        title: 'Creaming Method Science', 
                        note: 'Why we beat butter/sugar for 5 mins.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/creaming-method-cake-making/' },
                            { type: 'video', label: 'Cookie Science', url: 'https://bakerbettie.com/the-science-of-the-chocolate-chip-cookie/' }
                        ]
                    },
                    {
                        id: 'c2',
                        title: 'Master Cookies',
                        note: 'The gold standard cookie base.',
                        resources: [
                            { type: 'recipe', label: 'Chewy Cookies', url: 'https://bakerbettie.com/the-best-chewy-chocolate-chip-cookies/' }
                        ]
                    }
                ]
            },
            yeast: {
                title: "6. Yeast Breads",
                icon: "wheat",
                desc: "Patience and Kneading. Building strong gluten.",
                steps: [
                    { 
                        id: 'y1', 
                        title: 'Yeast Essentials', 
                        note: 'Active Dry vs Instant Yeast.',
                        resources: [
                            { type: 'read', label: 'Article', url: 'https://bakerbettie.com/yeast-essentials-everything-you-need-to-know-to-bake-with-yeast/' },
                            { type: 'video', label: 'Kneading Video', url: 'https://bakerbettie.com/how-to-knead-bread/' }
                        ]
                    },
                    {
                        id: 'y2',
                        title: 'Basic Loaf',
                        note: 'A classic sandwich loaf.',
                        resources: [
                            { type: 'recipe', label: 'Master Recipe', url: 'https://bakerbettie.com/simple-white-bread-recipe/' }
                        ]
                    }
                ]
            }
        };

        // --- STATE MANAGEMENT ---
        let activeModule = 'prep';
        let completed = JSON.parse(localStorage.getItem('bakerBettieProgress')) || {};

        // --- CORE FUNCTIONS ---
        
        function toggleComplete(id) {
            if (completed[id]) {
                delete completed[id];
            } else {
                completed[id] = true;
            }
            saveData();
            renderContent();
            renderSidebar();
            updateProgress();
        }

        function saveData() {
            localStorage.setItem('bakerBettieProgress', JSON.stringify(completed));
        }

        function updateProgress() {
            let totalSteps = 0;
            let completedSteps = 0;

            Object.values(modules).forEach(mod => {
                mod.steps.forEach(step => {
                    totalSteps++;
                    if (completed[step.id]) completedSteps++;
                });
            });

            const percentage = Math.round((completedSteps / totalSteps) * 100);
            document.getElementById('progress-bar').style.width = `${percentage}%`;
            document.getElementById('progress-text').innerText = `${percentage}%`;
        }

        // --- EXPORT / IMPORT FUNCTIONS ---
        function exportData() {
            const dataStr = btoa(JSON.stringify(completed));
            navigator.clipboard.writeText(dataStr).then(() => {
                alert("Progress Code copied to clipboard! \n\nSend this code to your other device and use the 'Restore' button.");
            }).catch(() => {
                prompt("Copy this code to transfer your progress:", dataStr);
            });
        }

        function importData() {
            const dataStr = prompt("Paste your progress code here:");
            if (!dataStr) return;

            try {
                const parsed = JSON.parse(atob(dataStr));
                if (typeof parsed === 'object') {
                    completed = parsed;
                    saveData();
                    renderSidebar();
                    renderContent();
                    alert("Progress restored successfully!");
                }
            } catch (e) {
                alert("Invalid code. Please try again.");
            }
        }

        // --- RENDER FUNCTIONS ---
        function renderSidebar() {
            const nav = document.getElementById('sidebar-nav');
            nav.innerHTML = '';
            
            Object.keys(modules).forEach(key => {
                const mod = modules[key];
                
                const modTotal = mod.steps.length;
                const modCompleted = mod.steps.filter(s => completed[s.id]).length;
                const isDone = modTotal === modCompleted && modTotal > 0;

                const btn = document.createElement('button');
                btn.className = `w-full text-left p-4 hover:bg-slate-50 transition-colors module-btn flex items-center justify-between group ${activeModule === key ? 'active' : 'text-slate-600'}`;
                btn.onclick = () => { 
                    activeModule = key; 
                    renderContent(); 
                    renderSidebar(); 
                    closeMobileMenu();
                };
                
                btn.innerHTML = `
                    <div class="flex items-center gap-3">
                        <i data-lucide="${mod.icon}" class="${activeModule === key ? 'text-orange-500' : 'text-slate-400'}"></i>
                        <span class="font-medium text-sm">${mod.title}</span>
                    </div>
                    ${isDone ? '<i data-lucide="check-circle-2" class="text-green-500 w-4 h-4"></i>' : ''}
                `;
                nav.appendChild(btn);
            });
            updateProgress();
            lucide.createIcons();
        }

        function renderContent() {
            const container = document.getElementById('main-content');
            const data = modules[activeModule];
            
            let html = `
                <div class="mb-8">
                    <div class="flex items-center gap-3 text-orange-600 mb-2">
                        <i data-lucide="${data.icon}" size="28"></i>
                        <h2 class="text-3xl font-bold text-slate-800">${data.title}</h2>
                    </div>
                    <p class="text-slate-500 text-lg border-l-4 border-orange-200 pl-4 py-1">${data.desc}</p>
                </div>
                <div class="space-y-4 max-w-4xl">
            `;

            data.steps.forEach(step => {
                const isChecked = completed[step.id];
                
                // Generate buttons for each resource in the step
                let buttonsHtml = '';
                if (step.resources && step.resources.length > 0) {
                    buttonsHtml = step.resources.map(r => {
                        let icon = r.type === 'video' ? 'play-circle' : (r.type === 'recipe' ? 'utensils' : 'book-open');
                        let colorClass = r.type === 'video' ? 'text-red-700 bg-red-50 hover:bg-red-100 border-red-200' : 
                                       (r.type === 'recipe' ? 'text-orange-700 bg-orange-50 hover:bg-orange-100 border-orange-200' : 
                                       'text-blue-700 bg-blue-50 hover:bg-blue-100 border-blue-200');
                        
                        return `<a href="${r.url}" target="_blank" onclick="event.stopPropagation()" class="flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-semibold transition-all ${colorClass} border shadow-sm">
                            <i data-lucide="${icon}" class="w-3.5 h-3.5"></i> ${r.label}
                        </a>`;
                    }).join('');
                }

                html += `
                <div onclick="toggleComplete('${step.id}')" class="group bg-white border rounded-xl p-5 shadow-sm transition-all hover:shadow-md cursor-pointer flex gap-4 ${isChecked ? 'checkbox-checked border-green-200' : 'border-gray-200 hover:border-orange-300'}">
                    
                    <div class="mt-1">
                        <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${isChecked ? 'bg-green-500 border-green-500' : 'border-gray-300 group-hover:border-orange-400'}">
                            <i data-lucide="check" class="text-white w-4 h-4 ${isChecked ? 'block' : 'hidden'}"></i>
                        </div>
                    </div>

                    <div class="flex-1">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-2">
                            <h3 class="text-lg font-semibold ${isChecked ? 'strikethrough text-slate-500' : 'text-slate-800'}">
                                ${step.title}
                            </h3>
                            <div class="flex flex-wrap gap-2">
                                ${buttonsHtml}
                            </div>
                        </div>
                        <p class="text-sm text-slate-500">${step.note}</p>
                    </div>
                </div>`;
            });

            html += `</div>
                <div class="mt-10 p-4 bg-yellow-50 rounded-lg border border-yellow-100 flex gap-3 text-sm text-yellow-800 safe-pb">
                    <i data-lucide="lightbulb" class="flex-shrink-0"></i>
                    <div>
                        <strong>Pro Tip:</strong> Click anywhere on the card to check it off. Use the buttons to open the actual content.
                    </div>
                </div>
            `;

            container.innerHTML = html;
            lucide.createIcons();
        }

        // --- MOBILE MENU LOGIC ---
        const menuToggle = document.getElementById('menu-toggle');
        const menuClose = document.getElementById('menu-close');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        function openMobileMenu() {
            sidebar.classList.remove('-translate-x-full');
            overlay.classList.remove('hidden');
        }

        function closeMobileMenu() {
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        }

        menuToggle.addEventListener('click', openMobileMenu);
        menuClose.addEventListener('click', closeMobileMenu);
        overlay.addEventListener('click', closeMobileMenu);

        // --- INITIALIZATION ---
        renderSidebar();
        renderContent();

    </script>
</body>
</html>
